name: Test code-base
description: Tests the code-base
inputs:
  baseline-branch:
    description: Name of branch to store baseline on
    required: false
    default: master
runs:
  using: composite
  steps:

    - name: Run unit tests
      shell: bash
      run: npm test

    - name: Upload test results
      uses: actions/upload-artifact@master
      with:
        name: test-results
        path: .jest-results.json

    - name: Upload coverage report
      uses: actions/upload-artifact@master
      with:
        name: coverage-report
        path: coverage

    - name: Update test results
      shell: bash
      if: ${{ github.event_name == 'push' && github.ref == format('refs/heads/{0}', inputs.baseline-branch) }}
      run: |
        git add -f .jest-results
        git config --global user.name "scan+github-actions[bot]"
        git config --global user.email "scan+github-actions[bot]@users.noreply.github.com"
        git commit -m "Update Jest results"
        git push
